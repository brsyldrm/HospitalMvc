@model HospitalMvc.Models.ViewModel.PatientAddDateVm
@{
    ViewBag.Title = "Patient";
    Layout = "~/Views/Shared/Layout2.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script>
    $(function () {
        $('#DrpBranch').change(function () {
            var id = $('#DrpBranch').val();
            $.ajax({
                url: '/Home/doctorgetir',
                data: { p: id },
                type: "POST",
                dataType: "Json",
                success: function (data) {
                    $('#DrpDoctor').empty();
                    $('#DrpDoctor').append("<option value='" +"0" + "'>" + "Doktor Seçiniz..." + "</Option>");
                    for (var i = 0; i < data.length; i++) {
                        $('#DrpDoctor').append("<option value='" + data[i].Value + "'>" + data[i].Text + "</Option>");
                    }
                }
            });
        });
    });

    
    $(function () {
        var ddList = document.querySelector("#datetime")
        var currentDate = new Date();
        $('#DrpDoctor').change(function () {
            var id = $('#DrpDoctor').val();
            $.ajax({
                url: '/Home/GetBusyDaysByDoctorId',
                data: { p: id },
                type: "POST",
                dataType: "Json",
                success: function (data) {
                    console.log("amk");
                    console.log(data);
                    for (var i = 1; i < 16; i++){
                        for (var j = 9; j < 17; j++){
                            for (var x = 0; x < 46; x+=15){
                                console.log("amk1");
                                var tmp = 
                                $('#datetime').append("<option value='" + tmp + "'>" + tmp + "</Option>");
                            }
                        }
                    }
                }
            });
        });
    });


</script>
<script>
    function getDoctorId() {
        let x = document.querySelector("#DrpDoctor");
        return x.options[x.selectedIndex].value;
    }
</script>

<div class="container text-center">
    @Html.Action("PatientList", "Home")


    <div class="col-6">
        <h5>Randevu Oluşturma</h5>
        @using (Html.BeginForm("Patient", "Home", FormMethod.Post))
        {
            @Html.Label("Poliklinik")
            @Html.DropDownList("DrpBranch", Model.Branches, "Poliklinik seçin", new { @class = "form-control" })
            <br />
            @Html.Label("Doktor")
            @Html.DropDownList("DrpDoctor", Model.Doctors, "Doktor seçin", new { @class = "form-control" })
            <br />
            @Html.Label("Randevu Tarih ve Saat")
            <select id="datetime" name="datetime" class="form-control">
                @*@for (int i = 1; i < 16; i++)
                {
                    for (int j = 9; j < 17; j++)
                    {
                        for (int x = 0; x < 46; x += 15)
                        {
                            <option value="@Convert.ToDateTime(DateTime.Now.ToString("dd/MM/yyyy")).AddDays(@i).AddHours(@j).AddMinutes(@x)">@Convert.ToDateTime(DateTime.Now.ToString("dd/MM/yyyy")).AddDays(@i).AddHours(@j).AddMinutes(@x)</option>
                        }
                    }
                }*@
            </select>
            <button class="btn btn-danger" type="submit">Randevu Al</button>
        }
    </div>
</div>
</div>
