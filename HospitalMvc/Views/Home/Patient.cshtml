@model HospitalMvc.Models.ViewModel.PatientAddDateVm
@{
    ViewBag.Title = "Patient";
    Layout = "~/Views/Shared/Layout2.cshtml";
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script>
    $(function () {
        $('#DrpBranch').change(function () {
            var id = $('#DrpBranch').val();
            $.ajax({
                url: '/Home/doctorgetir',
                data: { p: id },
                type: "POST",
                dataType: "Json",
                success: function (data) {
                    $('#DrpDoctor').empty();
                    $('#DrpDoctor').append("<option value='" +"0" + "'>" + "Doktor Seçiniz..." + "</Option>");
                    for (var i = 0; i < data.length; i++) {
                        $('#DrpDoctor').append("<option value='" + data[i].Value + "'>" + data[i].Text + "</Option>");
                    }
                }
            });
        });
    });

    
    $(function () {
        var ddList = document.querySelector("#datetime")
        var currentDate = new Date();
        $('#DrpDoctor').change(function () {
            var id = $('#DrpDoctor').val();
            $.ajax({
                url: '/Home/GetBusyDaysByDoctorId',
                data: { p: id },
                type: "POST",
                dataType: "Json",
                success: function (data) {
                    for (var i = 0; i <= data.length; i++){
                var tmp = data[i].Date;
                tmp = tmp.split(" ");
                switch (tmp[0]) {
                    case "Jan":
                        tmp[0] = 01;
                        break;
                    case "Feb":
                        tmp[0] = 02;
                        break;
                    case "Mar":
                        tmp[0] = 03;
                        break;
                    case "Apr":
                        tmp[0] = 04;
                        break;
                    case "May":
                        tmp[0] = 05;
                        break;
                    case "June":
                        tmp[0] = 06;
                        break;
                    case "July":
                        tmp[0] = 07;
                        break;
                    case "Agu":
                        tmp[0] = 08;
                        break;
                    case "Sep":
                        tmp[0] = 09;
                        break;
                    case "Oct":
                        tmp[0] = 10;
                        break;
                    case "Nov":
                        tmp[0] = 11;
                        break;
                    case "Dec":
                        tmp[0] = 12;
                        break;
                        }
                        console.log(tmp[3]);
                        data[i].Date = tmp[1] + "/" + tmp[0] + "/" + tmp[2] + " " + tmp[3];
                        console.log(data[i].Date);
            }
                    
                    //let dis = "disabled";
                    //for (var i = 1; i < 16; i++){
                    //    currentDate.setDate(currentDate.getDate() + 1);
                    //    for (var j = 9; j < 17; j++){
                    //        currentDate.setHours(j);
                    //        for (var x = 0; x < 46; x += 15){
                    //            currentDate.setMinutes(x);
                    //            let fulltime = (currentDate.getDate() + "/" + (currentDate.getMonth() + 1) + "/" +
                    //                currentDate.getFullYear() + "  " + currentDate.getHours() + ":" + currentDate.getMinutes());
                    //            for (var k = 0; k < data.length; k++) {

                    //                var g = new Date(data[k].Date)
                    //                if (data[k].Date != fulltime) {

                    //                    if (k == 1) { break; }
                    //                    else {
                    //                        console.log(fulltime);
                    //                        console.log(data[k].Date);
                    //                        $('#datetime').append("<option value='" + fulltime + "'>" + fulltime + "</Option>");
                    //                    }
                    //                }
                    //                else {
                    //                    $('#datetime').append("<option value='" + fulltime + "'" + dis + ">" + fulltime + "</Option>"); 
                //}
                //                }
                ////            }
                ////        }
                //    }
                }
            });
        });
    });
</script>
<script>
    function getDoctorId() {
        let x = document.querySelector("#DrpDoctor");
        return x.options[x.selectedIndex].value;
    }
</script>

<div class="container text-center">
    @Html.Action("PatientList", "Home")


    <div class="col-6">
        <h5>Randevu Oluşturma</h5>
        @using (Html.BeginForm("Patient", "Home", FormMethod.Post))
        {
            @Html.Label("Poliklinik")
            @Html.DropDownList("DrpBranch", Model.Branches, "Poliklinik seçin", new { @class = "form-control" })
            <br />
            @Html.Label("Doktor")
            @Html.DropDownList("DrpDoctor", Model.Doctors, "Doktor seçin", new { @class = "form-control" })
            <br />
            @Html.Label("Randevu Tarih ve Saat")
            <select id="datetime" name="datetime" class="form-control">
               
            </select>
            <button class="btn btn-danger" type="submit">Randevu Al</button>
        }
    </div>
</div>
</div>
